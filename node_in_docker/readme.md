### 250913
# Slurm node in docker 구성
### 먼저 docker network를 하나 구성하자.
```
docker network create slurm-net
```
### <br/>

### 그 다음 컨트롤 노드, 워커 노드를 구성한다.
```
docker run -itd --network slurm-net --hostname slurm --name slurm nathanhess/slurm:full-root
docker run -itd --network slurm-net --hostname slurm_node1 --name slurm_node1 nathanhess/slurm:full-root
```
### <br/>

### /etc/slurm/slurm.conf를 수정한다.
#### 여기서 CPU, memory, hostname은 각 컨테이너 hostname으로 자동으로 적히는데, 각 마스터 / 워커 노드에 config를 수정해줘야 한다.
#### 참고로 시스템에서 인식하는 CPU, memory를 그대로 넣어줘야 에러가 나지 않으므로 CPU, memory는 별도로 수정하지 않는다.
#### 수정해야 하는 항목
- SlurmctldHost=slurm : 마스터노드의 hostname을 적는다.
- COMPUTE NODES 부분에 마스터 노드 + 워커 노드 모두를 적는다.
```
# slurm.conf file generated by configurator easy.html.
# Put this file on all nodes of your cluster.
# See the slurm.conf man page for more information.
#
ClusterName=cluster
SlurmctldHost=slurm
#
#MailProg=/bin/mail
MpiDefault=none
#MpiParams=ports=#-#
ProctrackType=proctrack/linuxproc
ReturnToService=1
SlurmctldPidFile=/var/run/slurmctld.pid
#SlurmctldPort=6817
SlurmdPidFile=/var/run/slurmd.pid
#SlurmdPort=6818
SlurmdSpoolDir=/var/spool/slurmd
SlurmUser=slurm
#SlurmdUser=root
StateSaveLocation=/var/spool/slurmctld
SwitchType=switch/none
TaskPlugin=task/none
#
#
# TIMERS
#KillWait=30
#MinJobAge=300
#SlurmctldTimeout=120
#SlurmdTimeout=300
#
#
# SCHEDULING
SchedulerType=sched/backfill
SelectType=select/cons_tres
SelectTypeParameters=CR_Core
#
#
# LOGGING AND ACCOUNTING
AccountingStorageType=accounting_storage/none
#JobAcctGatherFrequency=30
JobAcctGatherType=jobacct_gather/none
#SlurmctldDebug=info
SlurmctldLogFile=/var/log/slurmctld.log
#SlurmdDebug=info
SlurmdLogFile=/var/log/slurmd.log
#
#
# COMPUTE NODES
NodeName=slurm CPUs=32 RealMemory=64263 State=UNKNOWN
NodeName=slurm_node1 CPUs=32 RealMemory=64263 State=UNKNOWN
PartitionName=debug Nodes=ALL Default=YES MaxTime=INFINITE State=U

```
### <br/>

### slurmd restart
#### 마스터 + 워커 둘 다에서 한다.
```
service slurmd restart
```
### <br/>

### 연결 확인
#### <img width="452" height="58" alt="image" src="https://github.com/user-attachments/assets/f89c4198-6ca2-4fc2-8e7a-4cdd93719d1a" />
